---
title: "ProjektR"
output: html_document
author: Andrzej S³owiñski
date: "`r format(Sys.time(), '%d %B, %Y')`"
---

```{r instalacja paczek}
install.packages("dplyr")
install.packages("knitr")
install.packages("ggplot2")
install.packages("caret")
install.packages("ggcorrplot")
```


##U¿yte biblioteki
```{r import bibliotek}
set.seed(42)
library(dplyr)
library(knitr)
library(ggplot2)
library(caret)
library(ggcorrplot)
```


```{r czyszczenie starych zmiennych}
rm(list=ls())
Sys.setenv(LANG = "en")
```

```{r, cache=TRUE , odczyt danych}
initial <- read.csv(file = "sample_data2.csv", nrows = 1000, sep = ';',  header = TRUE)
classes <- sapply(initial, class)
data <- read.csv("sample_data2.csv", sep = ";", comment.char = "", header = TRUE, na.strings = c('NAN'),blank.lines.skip = TRUE)

```

```{r usuwanie danych dla wartoœci zmiennej res_name}
v_rm <- c("UNK", "UNX", "UNL", "DUM", "N", "BLOB", "ALA", "ARG", "ASN", "ASP", "CYS", "GLN", "GLU", "GLY", "HIS", "ILE", "LEU", "LYS", "MET", "MSE", "PHE", "PRO", "SEC", "SER", "THR", "TRP", "TYR", "VAL", "DA", "DG", "DT", "DC", "DU", "A", "G", "T", "C", "U", "HOH", "H20", "WAT", "XCC")

data_exclude_some_res_names <- data %>% filter(!is.na(res_name), !is.nan(res_name),!res_name %in% v_rm)

```

```{r, cache=TRUE, przetwarzanie brakujacych danych}
data_without_missing_val <- data_exclude_some_res_names %>% replace(is.na(.), 0)
data_without_missing_val_distinct <- data_without_missing_val %>% distinct(pdb_code, res_name)

```

```{r wstêpne podsumowanie danych}
#kable(summary(data_without_missing_val))
```

```{r ograniczanie do 50 najpopularniejszych wartoœci}
data_without_missing_val_distinct <- data_without_missing_val %>% distinct(pdb_code, res_name)
names_of_RES_NAMES_first_50 <- data_without_missing_val_distinct %>% group_by(res_name) %>% summarise(n = n()) %>% arrange(desc(n)) %>% head(50) %>% select(res_name)
names_of_RES_NAMES_first_50_vector <- unlist(names_of_RES_NAMES_first_50)
data_without_missing_val_50_most_popular <- data_without_missing_val  %>% filter(res_name %in% names_of_RES_NAMES_first_50_vector)

```

```{r kolumny usuwane do klasyfikacji czysczenie}
delete_coulmn <- c( "dict_atom_non_h_count", "dict_atom_non_h_electron_sum", "dict_atom_C_count", "dict_atom_N_count", "dict_atom_O_count", "dict_atom_S_count",  "title", "part_step_FoFc_std_min","part_step_FoFc_std_max","part_step_FoFc_std_step","fo_col", "fc_col", "weight_col", "grid_space", "solvent_radius", "solvent_opening_radius", "local_res_atom_count", "local_res_atom_non_h_count", "local_res_atom_non_h_occupancy_sum", "local_res_atom_non_h_electron_sum", "local_res_atom_non_h_electron_occupancy_sum", "local_res_atom_C_count", "local_res_atom_N_count", "local_res_atom_O_count", "local_res_atom_S_count","pdb_code", "res_name","res_id","chain_id", "blob_coverage","res_coverage","skeleton_data")
```

```{r Korelacja }
Sys.setenv(LANG = "pl")

data_without_missing_val_50_most_popular_without_not_cor_collumn <- data_without_missing_val_50_most_popular %>% select(-delete_coulmn)

data_corelation <- cor(data_without_missing_val_50_most_popular_without_not_cor_collumn, use = "pairwise.complete.obs")

ggcorrplot(data_corelation)
```

```{r Okreœlenie ile przyk³adów ma ka¿da z klas (res_name).}
#pierwsze 50 popularnych
res_name_number_of_data <- data_without_missing_val_distinct %>% group_by(res_name) %>% summarise(n = n()) %>% arrange(desc(n)) %>% head(10)

ggplot(res_name_number_of_data , aes(x = res_name, y = n, order = desc(n))) + geom_bar(stat="identity") 

```

```{r rozk³ad liczby atomów (local_res_atom_non_h_count) i elektronów (local_res_atom_non_h_electron_sum).}

rozk <- stack(data_without_missing_val %>% select(local_res_atom_non_h_count, local_res_atom_non_h_electron_sum))

ggplot(rozk, aes(x = values)) + geom_density(aes(group=ind, colour=ind, fill=ind), alpha=0.3)


```


```{r tabela 10 klas z najwiêksz¹ niezgodnoœci¹ liczby atomów i elektronów }





```